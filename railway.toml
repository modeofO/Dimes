# Railway configuration for Dimes CAD
# This file defines how Railway builds and deploys each service

[build]
# Default build settings (can be overridden per service)
builder = "dockerfile"

# ============================================
# Service: Python CAD Backend (pythonOCC)
# ============================================
[[services]]
name = "cad-backend"
rootDirectory = "serverpy"

[services.build]
dockerfilePath = "Dockerfile"

[services.deploy]
healthcheckPath = "/api/v1/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[[services.variables]]
name = "PORT"
value = "8080"

# ============================================
# Service: Node.js API Server
# ============================================
[[services]]
name = "api-server"
rootDirectory = "api-server"

[services.build]
dockerfilePath = "Dockerfile"

[services.deploy]
healthcheckPath = "/api/v1/health"
healthcheckTimeout = 120
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[[services.variables]]
name = "PORT"
value = "3000"

[[services.variables]]
name = "NODE_ENV"
value = "production"

# Note: CPP_BACKEND_URL should be set to the internal Railway URL of cad-backend
# e.g., http://cad-backend.railway.internal:8080

# ============================================
# Service: Next.js Client
# ============================================
[[services]]
name = "client"
rootDirectory = "client"

[services.build]
dockerfilePath = "Dockerfile"

[services.deploy]
healthcheckPath = "/"
healthcheckTimeout = 120
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[[services.variables]]
name = "PORT"
value = "3001"

# Note: Set these in Railway dashboard for proper URLs
# NEXT_PUBLIC_API_URL = https://api-server-xxx.railway.app
# NEXT_PUBLIC_WS_URL = wss://api-server-xxx.railway.app
